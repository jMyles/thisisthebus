{% extends 'shared/generic-page.html' %}

{% load multimedia_tags %}
{% load parser_tags %}

{% block main %}
<div id="main" class="underSlice">
    <div class="blackMainInfo experiences">

        <div class="experienceContainer era">
            <h2>{{era.name}}</h2>
            <h3 class="bigDate">{{era.start_maya.slang_date}} - {{era.end_maya.slang_date}}</h3>
            <h4>{{era.summary|safe}}</h4>

            <div class="contentSection">
                {% parse_md_dj era.description %}
            </div>

            <div class="contentSection">
                {% for section_name, section in era.sections.items %}
                    <div class="sub-experience {% cycle 'left' 'right' %}">
                    <h3>{{section_name}}</h3>
                    {% for media_object in section.multimedia %}
                       {% include_media media_object %}
                    {% endfor %}
                    {% parse_md_dj section.text %}
                    </div>
                {% endfor %}
            </div>

            <div class="contentSection gridWrapper">
                {% for experience, location_stuff in era.locations_from_intersecting_experiences %}
                    {% cycle '1' '2' '3' as colorcycle silent %}
                    {% for location, position, must_clear in location_stuff %}
                    <a href="/experiences/{{ experience.slug }}.html">
                        <div class="gridItem contrast-{{colorcycle}} {% if forloop.first %}first{%endif%} {%if forloop.last %}last{%endif%} pos-{{position}} count-{{ forloop.counter }} end-{{ forloop.revcounter0}} {% if forloop.revcounter0 < 3 %}last3{% endif %} {% if forloop.counter0 < 3 %}first3{% endif %} groupOf-{{locations|length}}" {% if must_clear %}style="clear:left"{% endif %}>
                            <div class="topNote">
                                {% if forloop.first %}
                                    <div class="groupName">{{experience}}</div>
                                {% endif %}
                            </div>
                            {% with location.place as place %}
                              <div class="locationContainer">
                                  {% with omit_small_name=True no_link=True %}
                                    {% include 'where/single-place.html' %}
                                  {% endwith %}
                              </div>
                            {% endwith %}
                        </div>
                    </a>
                    {% endfor %}
                {% endfor %}
            </div>

        </div>
    </div>
</div>
{% endblock %}